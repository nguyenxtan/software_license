version: '3.8'

services:
  # Backend API (connect to existing PostgreSQL container)
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: software_license_api
    environment:
      # Connect to existing container via host network
      DATABASE_URL: postgresql://license_admin:LicenseDemo@2025@217.217.252.57:5433/software_license?schema=public
      PORT: 3000
      NODE_ENV: production
      JWT_SECRET: ${JWT_SECRET:-change_this_in_production}
      JWT_EXPIRES_IN: 7d
      SMTP_HOST: ${SMTP_HOST}
      SMTP_PORT: ${SMTP_PORT:-587}
      SMTP_SECURE: ${SMTP_SECURE:-false}
      SMTP_USER: ${SMTP_USER}
      SMTP_PASS: ${SMTP_PASS}
      EMAIL_FROM: ${EMAIL_FROM:-Hệ thống quản lý <noreply@company.com>}
      FRONTEND_URL: ${FRONTEND_URL:-http://217.217.252.57:5173}
      DEFAULT_REMINDER_DAYS: 90,60,30,7,1
      ENABLE_AUTO_NOTIFICATIONS: ${ENABLE_AUTO_NOTIFICATIONS:-true}
      AUTH_PROVIDER: local
    ports:
      - "3001:3000"
    restart: unless-stopped
    network_mode: "host"

# Note: Dùng existing PostgreSQL container (software_license_db)
# Không cần tạo service postgres trong compose
